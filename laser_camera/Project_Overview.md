

# 激光星芒破夜绘明检测平台 · 项目总览

## 一、项目概述

### 1.1 行业背景与典型痛点

在安防监控、变电站运维、工业机柜检修等场景中，夜间与弱光环境依然是安全管理的薄弱环节：

- **传统可见光摄像头依赖环境光**，夜间画面噪声大、细节丢失，无法可靠识别人、动作与关键安全标识（如警戒黄线）。
- **纯视频监控缺乏“距离感知”能力**，无法判断人员是否真正处于安全距离内，只能依靠人眼主观判断，存在误判与漏判风险。
- **现场授权流程与物理安全脱节**：值班员在系统中授权了某一机柜，但现场操作人员可能走错机柜、越过安全线或靠近未授权设备，系统难以及时发现并联动告警。
- **夜间与复杂环境下的运维负担重**，需要额外人力巡检，且对人员经验依赖大，难以形成可量化、可追溯的安全闭环。

在“双碳”“数字化电网”“工业互联网”等政策与行业趋势推动下，业主方对**“可量化、可追溯、可联动”**的智能安全检测平台提出了更高要求。

### 1.2 项目总体目标

本项目拟构建一套 **“激光距离感知 + 图像智能分析 + 多模态告警联动”** 的综合检测平台，核心量化目标包括：

- 夜间与弱光环境下，人员与机柜的**检测与追踪精度 ≥ 95%**。
- 对授权机柜的**位置匹配误差 ≤ ±5 cm**，可稳定区分相邻机柜及间隙。
- 安全距离、黄线越界等事件的**误报率与漏报率均控制在 5% 以内**。
- 系统支持 **7×24 小时连续运行**，年可用时长 ≥ 8000 小时。
- 与继电器 / 报警灯 / PLC 等现场设备实现**毫秒级联动响应**，用于切断操作权限或触发声光告警。

### 1.3 典型应用场景

1. **变电站机柜运维安全管控**  
   - 管理员在后台为某台或多台机柜下发“授权窗口”。  
   - 现场人员在授权时间内进入机柜区域，通过激光 + 图像双重校验，确保“人在对的机柜前、站在对的安全线外”。

2. **工业机房 / 数据中心精密设备维护**  
   - 通道狭窄、机柜密集，容易走错位置或误触无关设备。  
   - 平台通过机柜坐标与人员位姿检测，实时判断是否越界或靠近未授权设备。

3. **夜间安防与巡检支持**  
   - 在弱光环境下，将激光测距与黑白夜视图像结合，实现人员入侵检测、禁区越界提醒等功能。  

### 1.4 核心需求清单（简要）

按优先级划分，当前阶段聚焦如下需求：

1. **安全核心链路（必须）：**
   - 人员是否处于授权机柜前；
   - 人员是否在安全线外（或踩线范围内）；
   - 距离是否进入危险区（过近）；
   - 安全状态变化时是否可靠驱动继电器 / 报警灯 / PLC 输出。

2. **体验与扩展（增强）：**
   - UI 实时展示距离、机柜编号、黄线状态与整体安全等级（SAFE / CAUTION / DANGER）；
   - 支持历史日志与融合数据（距离 + 图像状态）导出分析；
   - 预留温度传感器、更多相机模组（如热成像）的接入能力。

---

## 二、总体解决方案设计

### 2.1 设计原则

- **技术先进但可落地：** 优先选用成熟稳定的激光测距模组与嵌入式视觉方案，算法可迭代升级。  
- **稳定可靠：** 激光测距与图像处理分层解耦，即使视觉部分异常，安全距离逻辑仍可独立工作。  
- **可扩展：** 目录结构与模块命名遵循策略模式思想，便于后续新增传感器或替换算法实现。  
- **易运维：** 串口检测脚本自动识别设备端口，减少现场人工配置；日志与配置集中管理。  

### 2.2 平台总体架构

从下到上，整体架构可分为四层：

1. **硬件层**  
   - 激光测距模组（TOF/LIDAR）  
   - 摄像头 / 夜视模组（含未来的 CanMV、IR、温度传感器等）  
   - 工控机或上位机（运行 Python 工程）  
   - 继电器 / 报警灯 / PLC 等执行机构

2. **驱动与数据采集层**  
   - 串口自动检测与配置脚本（`serial_port_detect.py`）  
   - 激光测距采集模块（封装串口协议与距离解码）  
   - 摄像头采集模块（实时图像流 + 关键点/目标检测结果）

3. **算法与逻辑层**  
   - 距离与机柜区域映射算法（机柜位置建模、授权区域判断）  
   - 黄线越界算法（基于脚尖位置与虚拟黄带区域的判别）  
   - 多帧图像对比与运动检测（判断是否有人、是否在移动）  
   - 综合安全判决逻辑（SAFE / CAUTION / DANGER + 是否允许操作）

4. **应用与展示层**  
   - CLI / UI 程序：展示距离、状态与日志；  
   - 图像对比可视化界面（后续加入摄像画面与黄线叠加）；  
   - 与上层业务系统的对接接口（预留 HTTP / MQTT 等）

---

## 三、当前阶段子系统：激光测距 + 图像对比

本阶段的工程重点是完成 **“激光距离感知 + 图像黄线监测”** 两个子系统，并打通与安全控制输出之间的闭环。

### 3.1 子系统功能概览

1. **激光测距子系统（`lidar_distance`）**
   - 从串口实时读取激光测距数据，转换为厘米级距离。  
   - 将连续的距离值映射到机柜索引与授权状态：
     - 区分 1～N 号机柜与机柜间隙；
     - 根据后台授权列表判断当前机柜是否“AUTHORIZED/UNAUTHORIZED”；
   - 根据距离阈值判定是否“过近”，输出 SAFE/CAUTION/DANGER 等级。  
   - 支持将融合后的数据记录到 `fusion_log.csv`，用于离线分析与回放。

2. **图像对比与黄线监测子系统（`pic_compare`）**
   - 使用摄像头捕获实时图像，对比前后帧或参考帧，检测是否有人员出现及是否存在明显移动（运动检测）。  
   - 在图像坐标系中定义虚拟黄带区域：  
     - 区分 **线外安全区（OUTSIDE_SAFE）**、**踩线安全区（ON_LINE_SAFE）** 与 **线内危险区（INSIDE_DANGER）**；  
     - 通过脚尖点、双肩位置或特定关键点判断人员相对黄线的位置。  
   - 结合多帧状态跟踪（`TRANSITION`、`SAFE_STABLE`、`DANGER_STABLE`），避免抖动与误判。  
   - 将图像侧的安全结论（line_zone、line_state）与激光测距结果一起送入综合安全控制模块。

3. **综合安全控制与输出（`overall_safety` / `safety_controller` 思想延续）**
   - 输入：
     - 激光距离与机柜授权状态；
     - 图像黄线区域状态与运动检测结果；
   - 输出：
     - 系统安全等级：SAFE / WARNING / BLOCKED；
     - 是否允许当前操作（`output_enabled=True/False`）；
     - 供继电器 / 报警灯 / PLC 使用的数字信号。

### 3.2 关键算法逻辑（简要）

1. **机柜区域映射算法**  
   - 以激光安装点为基准，建立一维距离坐标；  
   - 配置每台机柜的**起止距离区间**以及机柜间隙距离；  
   - 将实时测得的距离落入对应区间，得到当前机柜索引 `cabinet_idx`，并与授权列表匹配。

2. **黄线越界判定算法**  
   - 在图像平面上用一条或一带直线表示黄线：`ax + by + c = 0`；  
   - 通过平移参数构造安全带（线外 + 踩线范围），形成 `[c_min, c_max]` 的安全区；  
   - 根据脚尖投影点到黄线的有向距离，判断是 OUTSIDE_SAFE / ON_LINE_SAFE / INSIDE_DANGER；  
   - 对连续多帧结果进行状态机跟踪，过滤偶然抖动，稳定后再触发安全等级变化。

3. **多模态安全判决**  
   - 若 **距离危险或机柜未授权**，即使黄线侧判断为安全，也将整体判为 BLOCKED；  
   - 若 **距离安全但黄线被越界**，同样视为 BLOCKED；  
   - 仅当：
     - 人在授权机柜前；
     - 距离在安全阈值之外；
     - 黄线状态为 OUTSIDE_SAFE 或 ON_LINE_SAFE；
     - 运动状态稳定（非短暂抖动）；
     时才输出 SAFE 且允许操作。

### 3.3 工程目录结构说明

当前工程按功能划分为多个子目录，便于后续扩展：

- `laser_camera/lidar_distance/PythonCode/core/`  
  - 激光测距、融合逻辑、安全控制等核心模块（`lidar_tof.py`、`zone_logic.py`、`safety_core.py` 等）。
- `laser_camera/lidar_distance/PythonCode/demo/`  
  - 各类命令行 / UI 演示脚本（如 `demo_new_lidar.py`、`demo_fusion_record.py`），用于快速自测与演示。  
- `laser_camera/lidar_distance/PythonCode/ui/`  
  - CLI 与 Flet UI 程序（`ui_cli.py`、`ui_flet.py`、`ui_distance.py`），用于展示距离与安全状态。  
- `laser_camera/lidar_distance/PythonCode/tools/`  
  - 串口检测脚本、日志分析工具等（`serial_port_detect.py`、`demo_analyze_fusion_log.py`）。
- `laser_camera/pic_compare/PythonCode/core/`  
  - 图像对比、黄线判定与 CanMV 集成相关逻辑（`vision_logic.py`、`vision_core.py`、`yellow_line_logic.py` 等）。
- `laser_camera/pic_compare/PythonCode/demo/`  
  - 图像对比与黄线检测的演示脚本（`demo_yellow_line.py`、`demo_motion_compare.py` 等，名称随实现调整）。

---

## 四、后续工作展望（与导师方案对齐）

在当前“激光 + 图像对比”子系统稳定运行的基础上，后续将逐步对齐导师提供的整体方案：

1. 引入 **夜视黑白成像模组** 与 **温度传感器**，扩展为多模态监测平台；  
2. 将当前 Python 原型迁移或对接至 **CanMV 等嵌入式平台**，实现前端边缘侧实时计算；  
3. 根据项目文档完善 **实施计划、测试方案、成本预算与验收标准**，形成可直接对外汇报与投标的完整解决方案；  
4. 在论文与项目报告中，将本工程沉淀为：
   - 一套可复用的“激光 + 视觉”安全检测框架；
   - 一组可量化的实验数据与性能指标，为后续学术研究与工程落地提供支撑。

上述内容作为本仓库的整体技术导览，后续每次新增模块或重要算法时，可在此文档中同步更新对应章节。